<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ğŸ‘¨ğŸ»â€ğŸ’» é—®é¢˜æ€»ç»“ | Docker Proxy</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/docs/img/favicon.ico">
    <meta name="description" content="è‡ªå»ºDockeré•œåƒåŠ é€ŸæœåŠ¡">
    
    <link rel="preload" href="/docs/assets/css/0.styles.cbb55f5f.css" as="style"><link rel="preload" href="/docs/assets/js/app.37458384.js" as="script"><link rel="preload" href="/docs/assets/js/2.6bef8de2.js" as="script"><link rel="preload" href="/docs/assets/js/1.0b991997.js" as="script"><link rel="preload" href="/docs/assets/js/24.0b5ffd20.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.f83ce346.js"><link rel="prefetch" href="/docs/assets/js/11.7fc77a67.js"><link rel="prefetch" href="/docs/assets/js/12.a9575367.js"><link rel="prefetch" href="/docs/assets/js/13.fa701c04.js"><link rel="prefetch" href="/docs/assets/js/14.ed1ac61a.js"><link rel="prefetch" href="/docs/assets/js/15.e619fe39.js"><link rel="prefetch" href="/docs/assets/js/16.4cb39eda.js"><link rel="prefetch" href="/docs/assets/js/17.b20363c1.js"><link rel="prefetch" href="/docs/assets/js/18.b7eb8ff9.js"><link rel="prefetch" href="/docs/assets/js/19.243b82f4.js"><link rel="prefetch" href="/docs/assets/js/20.914c528f.js"><link rel="prefetch" href="/docs/assets/js/21.f494545d.js"><link rel="prefetch" href="/docs/assets/js/22.35d3679d.js"><link rel="prefetch" href="/docs/assets/js/23.27505d65.js"><link rel="prefetch" href="/docs/assets/js/3.ca8b9487.js"><link rel="prefetch" href="/docs/assets/js/4.03dd6bf1.js"><link rel="prefetch" href="/docs/assets/js/5.f1b5dcb0.js"><link rel="prefetch" href="/docs/assets/js/6.a00fef8f.js"><link rel="prefetch" href="/docs/assets/js/7.a21ffd1b.js"><link rel="prefetch" href="/docs/assets/js/vendors~docsearch.0720d671.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.cbb55f5f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">Docker Proxy</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/" class="nav-link">
  ä¸»é¡µ
</a></div><div class="nav-item"><a href="https://dqzboy.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  åšå®¢
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/docs/pages/install.html" class="nav-link">
  æ•™ç¨‹
</a></div><div class="nav-item"><a href="https://dqzboy.github.io/proxyui/zanzhu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  èµåŠ©
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://dqzboy.github.io/proxyui/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CMD UI
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/dqzboy/Docker-Proxy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/" class="nav-link">
  ä¸»é¡µ
</a></div><div class="nav-item"><a href="https://dqzboy.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  åšå®¢
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/docs/pages/install.html" class="nav-link">
  æ•™ç¨‹
</a></div><div class="nav-item"><a href="https://dqzboy.github.io/proxyui/zanzhu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  èµåŠ©
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://dqzboy.github.io/proxyui/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CMD UI
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/dqzboy/Docker-Proxy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/docs/pages/install.html" class="sidebar-link">å®‰è£…éƒ¨ç½²</a></li><li><a href="/docs/pages/isseus.html" aria-current="page" class="active sidebar-link">é—®é¢˜æ€»ç»“</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/pages/isseus.html#ğŸ‘¨ğŸ»â€ğŸ’»-é—®é¢˜æ€»ç»“" class="sidebar-link">ğŸ‘¨ğŸ»â€ğŸ’» é—®é¢˜æ€»ç»“</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="ğŸ‘¨ğŸ»â€ğŸ’»-é—®é¢˜æ€»ç»“"><a href="#ğŸ‘¨ğŸ»â€ğŸ’»-é—®é¢˜æ€»ç»“" class="header-anchor">#</a> ğŸ‘¨ğŸ»â€ğŸ’» é—®é¢˜æ€»ç»“</h2> <h4 id="_1ã€æ— æ³•é€šè¿‡uiç•Œé¢åˆ é™¤æŸä¸€é•œåƒçš„tag"><a href="#_1ã€æ— æ³•é€šè¿‡uiç•Œé¢åˆ é™¤æŸä¸€é•œåƒçš„tag" class="header-anchor">#</a> 1ã€æ— æ³•é€šè¿‡UIç•Œé¢åˆ é™¤æŸä¸€é•œåƒçš„TAG</h4> <ul><li><p>[x] <strong>å·²çŸ¥é—®é¢˜ï¼š</strong> ä½¿ç”¨<code>registry</code>ä½œä¸ºä»£ç†ç¼“å­˜æ—¶ä¸æ”¯æŒåˆ é™¤</p></li> <li><p>[x] <strong>issuesï¼š</strong> <a href="https://github.com/distribution/distribution/issues/3853" target="_blank" rel="noopener noreferrer">#3853<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p>[x] <strong>ä»£ç ç‰‡æ®µï¼š</strong> <a href="https://github.com/distribution/distribution/blob/main/registry/handlers/app.go#L349" target="_blank" rel="noopener noreferrer">configure as a pull through cache<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ul> <h4 id="_2ã€æ­å»ºå¥½äº†-ä½†æ˜¯å›½å†…æ‹‰å–é€Ÿåº¦ä¸ç†æƒ³"><a href="#_2ã€æ­å»ºå¥½äº†-ä½†æ˜¯å›½å†…æ‹‰å–é€Ÿåº¦ä¸ç†æƒ³" class="header-anchor">#</a> 2ã€æ­å»ºå¥½äº†ï¼Œä½†æ˜¯å›½å†…æ‹‰å–é€Ÿåº¦ä¸ç†æƒ³</h4> <ul><li><p>[x] <strong>å·²çŸ¥é—®é¢˜ï¼š</strong> ä½ çš„å›½å¤–æœåŠ¡å™¨åˆ°å›½å†…çš„ç½‘ç»œçº¿è·¯ä¸ç†æƒ³</p></li> <li><p>[x] <strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p> <ul><li>(1) å¼€å¯æœåŠ¡å™¨BBRï¼Œä¼˜åŒ–ç½‘ç»œæ€§èƒ½(æ•ˆæœæœ‰é™)</li> <li>(2) æ›´æ¢å¯¹å›½å†…ç½‘ç»œçº¿è·¯ä¼˜åŒ–æ›´å¥½çš„æœåŠ¡å™¨</li></ul></li></ul> <h4 id="_3ã€registry-é•œåƒç¼“å­˜å¤šå°‘æ—¶é—´-å¦‚ä½•è°ƒæ•´-å¦‚ä½•ç¦ç”¨"><a href="#_3ã€registry-é•œåƒç¼“å­˜å¤šå°‘æ—¶é—´-å¦‚ä½•è°ƒæ•´-å¦‚ä½•ç¦ç”¨" class="header-anchor">#</a> 3ã€registry é•œåƒç¼“å­˜å¤šå°‘æ—¶é—´ï¼Œå¦‚ä½•è°ƒæ•´ï¼Œå¦‚ä½•ç¦ç”¨</h4> <ul><li><p>[x] <strong>å·²çŸ¥é—®é¢˜ï¼š</strong> é»˜è®¤ç¼“å­˜<code>168h</code>ï¼Œä¹Ÿå°±æ˜¯<code>7å¤©</code>ã€‚ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­<code>proxy</code>é…ç½®å—ä¸­çš„<code>ttl</code> å‚æ•°è°ƒæ•´ç¼“å­˜æ—¶é—´ï¼Œ<code>0</code> ç¦ç”¨ç¼“å­˜è¿‡æœŸã€‚é»˜è®¤å•ä½ns</p> <ul><li><ul><li>è¦æ˜¯è°ƒåº¦ç¨‹åºæ­£å¸¸æ¸…ç†æ—§æ•°æ®ï¼Œéœ€è¦é…ç½®ä¸­å°† <code>delete</code> å¼€å¯ï¼ˆæœ¬é¡¹ç›®é»˜è®¤å·²å¼€å¯ï¼‰</li></ul></li></ul></li></ul> <h4 id="_4ã€ä½¿ç”¨é•œåƒåŠ é€Ÿæ‹‰å–hubå…¬å…±ç©ºé—´ä¸‹çš„é•œåƒæ—¶å¦‚ä½•ä¸æ·»åŠ library"><a href="#_4ã€ä½¿ç”¨é•œåƒåŠ é€Ÿæ‹‰å–hubå…¬å…±ç©ºé—´ä¸‹çš„é•œåƒæ—¶å¦‚ä½•ä¸æ·»åŠ library" class="header-anchor">#</a> 4ã€ä½¿ç”¨é•œåƒåŠ é€Ÿæ‹‰å–<code>hub</code>å…¬å…±ç©ºé—´ä¸‹çš„é•œåƒæ—¶å¦‚ä½•ä¸æ·»åŠ <code>library</code></h4> <ul><li>æ­¤æ–¹æ¡ˆæ¥è‡ªäº¤æµç¾¤é‡Œå¤§ä½¬æä¾›ï¼Œé€šè¿‡nginxå®ç°å¹¶å®æµ‹</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># å°†ä¸‹é¢çš„$http_upgrade $connection_upgradeå˜é‡æ·»åŠ åˆ°httpå—ä¸­</span>
http <span class="token punctuation">{</span>
    <span class="token comment"># ç”¨äºæ”¯æŒWebSocket</span>
    map <span class="token variable">$http_upgrade</span> <span class="token variable">$connection_upgrade</span> <span class="token punctuation">{</span>
        default upgrade<span class="token punctuation">;</span>
        <span class="token string">''</span>      close<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    server <span class="token punctuation">{</span>
        listen <span class="token number">80</span><span class="token punctuation">;</span>
        server_name hub.your_domain.com<span class="token punctuation">;</span>

        <span class="token comment"># åœ¨docker hubçš„é…ç½®ä¸­æ·»åŠ ä¸‹é¢çš„locationè§„åˆ™</span>
        location ^~ / <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$request_uri</span> ~  ^/v2/<span class="token punctuation">(</span><span class="token punctuation">[</span>^/<span class="token punctuation">]</span>+<span class="token punctuation">)</span>/<span class="token punctuation">(</span>manifests<span class="token operator">|</span>blobs<span class="token punctuation">)</span>/<span class="token punctuation">(</span>.*<span class="token punctuation">)</span>$<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment"># é‡å†™è·¯å¾„å¹¶æ·»åŠ  library/</span>
                    rewrite ^/v2/<span class="token punctuation">(</span>.*<span class="token punctuation">)</span>$ /v2/library/<span class="token variable">$1</span> <span class="token builtin class-name">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            proxy_pass http://127.0.0.1:51000<span class="token punctuation">;</span>
            proxy_set_header Host <span class="token variable">$host</span><span class="token punctuation">;</span>
            proxy_set_header X-Real-IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
            proxy_set_header X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span>
            proxy_set_header REMOTE-HOST <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
            proxy_set_header Upgrade <span class="token variable">$http_upgrade</span><span class="token punctuation">;</span>
            proxy_set_header Connection <span class="token variable">$connection_upgrade</span><span class="token punctuation">;</span>
            proxy_http_version <span class="token number">1.1</span><span class="token punctuation">;</span>
            add_header X-Cache <span class="token variable">$upstream_cache_status</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h4 id="_5ã€æ‹‰å–é•œåƒæŠ¥é”™-tls-failed-to-verify-certificate-x509-certificate-signed-by-unknown-authority"><a href="#_5ã€æ‹‰å–é•œåƒæŠ¥é”™-tls-failed-to-verify-certificate-x509-certificate-signed-by-unknown-authority" class="header-anchor">#</a> 5ã€æ‹‰å–é•œåƒæŠ¥é”™ <code>tls: failed to verify certificate: x509: certificate signed by unknown authority</code></h4> <ul><li>[x] <strong>å·²çŸ¥é—®é¢˜ï¼š</strong> è¯ä¹¦é—®é¢˜ã€‚è¡¨ç¤ºè¯ä¹¦æ˜¯ç”±ä¸€ä¸ªæœªçŸ¥çš„æˆ–ä¸å—ä¿¡ä»»çš„è¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰ç­¾å‘çš„ã€‚</li></ul> <h4 id="_6ã€é€šè¿‡docker-composeéƒ¨ç½²-å¦‚ä½•è®¾ç½®proxyè®¤è¯"><a href="#_6ã€é€šè¿‡docker-composeéƒ¨ç½²-å¦‚ä½•è®¾ç½®proxyè®¤è¯" class="header-anchor">#</a> 6ã€é€šè¿‡docker-composeéƒ¨ç½²ï¼Œå¦‚ä½•è®¾ç½®Proxyè®¤è¯</h4> <ul><li>[x] <strong>å·²çŸ¥é—®é¢˜ï¼š</strong> æŸ¥çœ‹æ•™ç¨‹ï¼š<a href="https://www.dqzboy.com/8709.html" target="_blank" rel="noopener noreferrer">è‡ªå»ºDockeré•œåƒåŠ é€ŸæœåŠ¡<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h4 id="_7ã€å¯¹äºæœåŠ¡å™¨çš„è§„æ ¼è¦æ±‚-å†…å­˜ã€cpuã€ç£ç›˜ã€å¸¦å®½ç½‘ç»œç­‰"><a href="#_7ã€å¯¹äºæœåŠ¡å™¨çš„è§„æ ¼è¦æ±‚-å†…å­˜ã€cpuã€ç£ç›˜ã€å¸¦å®½ç½‘ç»œç­‰" class="header-anchor">#</a> 7ã€å¯¹äºæœåŠ¡å™¨çš„è§„æ ¼è¦æ±‚ï¼Œå†…å­˜ã€CPUã€ç£ç›˜ã€å¸¦å®½ç½‘ç»œç­‰</h4> <ul><li>[x] <strong>å·²çŸ¥é—®é¢˜ï¼š</strong> å»ºè®®æœ€ä½ä½¿ç”¨1C1Gçš„æœåŠ¡å™¨ï¼Œç£ç›˜å¤§å°å–å†³äºä½ æ‹‰å–é•œåƒçš„é¢‘ç‡ä»¥åŠä¿å­˜é•œåƒç¼“å­˜çš„æ—¶é•¿å†³å®š(é»˜è®¤ç¼“å­˜7å¤©,éƒ¨ç½²æ—¶å¯è‡ªå®šä¹‰)ï¼›å¦‚æœå¯¹æ‹‰å–é€Ÿåº¦æœ‰è¦æ±‚ï¼Œæœ€å¥½é€‰æ‹©é’ˆå¯¹ä¸­å›½å¤§é™†è¿›è¡Œç½‘ç»œä¼˜åŒ–çš„æœåŠ¡å™¨</li></ul> <h4 id="_8ã€ç¼“å­˜åœ¨æœ¬åœ°ç£ç›˜ä¸Šçš„æ•°æ®æ˜¯å¦ä¼šè‡ªåŠ¨æ¸…ç†-å¦‚ä½•åˆ¤æ–­ç¼“å­˜æ˜¯å¦è¢«æ¸…ç†"><a href="#_8ã€ç¼“å­˜åœ¨æœ¬åœ°ç£ç›˜ä¸Šçš„æ•°æ®æ˜¯å¦ä¼šè‡ªåŠ¨æ¸…ç†-å¦‚ä½•åˆ¤æ–­ç¼“å­˜æ˜¯å¦è¢«æ¸…ç†" class="header-anchor">#</a> 8ã€ç¼“å­˜åœ¨æœ¬åœ°ç£ç›˜ä¸Šçš„æ•°æ®æ˜¯å¦ä¼šè‡ªåŠ¨æ¸…ç†ï¼Ÿå¦‚ä½•åˆ¤æ–­ç¼“å­˜æ˜¯å¦è¢«æ¸…ç†ï¼Ÿ</h4> <ul><li>[x] <strong>å·²çŸ¥é—®é¢˜ï¼š</strong> Registryä¼šå®šæœŸåˆ é™¤æ—§å†…å®¹ä»¥èŠ‚çœç£ç›˜ç©ºé—´ã€‚ä¸‹é¢ä¸ºå®˜æ–¹åŸæ–‡è§£é‡Šï¼š</li></ul> <blockquote><p>In environments with high churn rates, stale data can build up in the cache. When running as a pull through cache the Registry periodically removes old content to save disk space. Subsequent requests for removed content causes a remote fetch and local re-caching.
To ensure best performance and guarantee correctness the Registry cache should be configured to use the <code>filesystem</code> driver for storage.</p></blockquote> <ul><li><p>[x] <strong>å·²çŸ¥é—®é¢˜ï¼š</strong> å½“æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶å¼€å¯äº† <code>delete.enabled.true</code> é‚£ä¹ˆè°ƒåº¦ç¨‹åºä¼šè‡ªåŠ¨æ¸…ç†è¿‡æœŸçš„é•œåƒå±‚æˆ–æœªä½¿ç”¨çš„é•œåƒæ ‡ç­¾</p></li> <li><p>âš ï¸ æ³¨æ„ï¼šä¸è¦é€šè¿‡åœ¨UIä¸ŠæŸ¥çœ‹æŸä¸ªé•œåƒæ˜¯å¦è¢«åˆ é™¤æ¥åˆ¤æ–­è°ƒåº¦ç¨‹åºæ˜¯å¦å·²è‡ªåŠ¨æ‰§è¡Œåˆ é™¤æ“ä½œã€‚è€Œæ˜¯æŸ¥çœ‹å¯¹åº”ä»£ç†æœåŠ¡çš„å®¹å™¨æ—¥å¿—</p></li></ul> <h4 id="_9ã€æ‹‰å–äº†ä¸€ä¸ªé•œåƒä¹‹å-å‘ç°uiç•Œé¢æ²¡æœ‰æ˜¾ç¤º"><a href="#_9ã€æ‹‰å–äº†ä¸€ä¸ªé•œåƒä¹‹å-å‘ç°uiç•Œé¢æ²¡æœ‰æ˜¾ç¤º" class="header-anchor">#</a> 9ã€æ‹‰å–äº†ä¸€ä¸ªé•œåƒä¹‹åï¼Œå‘ç°UIç•Œé¢æ²¡æœ‰æ˜¾ç¤ºï¼Ÿ</h4> <ul><li>[x] <strong>å·²çŸ¥é—®é¢˜ï¼š</strong> Docker-Proxyéƒ¨ç½²çš„æœåŠ¡å™¨ä¸Šçš„å­˜å‚¨ç©ºé—´ä¸è¶³ã€‚å®¿ä¸»æœºé»˜è®¤çš„æŒ‚è½½ç›®å½• <code>./registry/data</code></li></ul> <h4 id="_10ã€å¼€å¯è®¤è¯å-é…ç½®daemon-jsonæŒ‡å®šäº†ä»£ç†åœ°å€-å¯ä»¥æ­£å¸¸ç™»å…¥-ä½†æ˜¯docker-pullé•œåƒæ—¶æ— æ³•æ‹‰å–é•œåƒ"><a href="#_10ã€å¼€å¯è®¤è¯å-é…ç½®daemon-jsonæŒ‡å®šäº†ä»£ç†åœ°å€-å¯ä»¥æ­£å¸¸ç™»å…¥-ä½†æ˜¯docker-pullé•œåƒæ—¶æ— æ³•æ‹‰å–é•œåƒ" class="header-anchor">#</a> 10ã€å¼€å¯è®¤è¯åï¼Œé…ç½®<code>daemon.json</code>æŒ‡å®šäº†ä»£ç†åœ°å€ï¼Œå¯ä»¥æ­£å¸¸ç™»å…¥ï¼Œä½†æ˜¯<code>docker pull</code>é•œåƒæ—¶æ— æ³•æ‹‰å–é•œåƒ</h4> <ul><li><p>[x] <strong>å·²çŸ¥é—®é¢˜ï¼š</strong> å› ä¸ºå¯¹äºç§æœ‰é•œåƒä»“åº“ï¼Œdockerå®¢æˆ·ç«¯å¯¹é•œåƒçš„ç›¸å…³æ“ä½œï¼Œæ¯”å¦‚pull pushæ”¯æŒä¸å‹å¥½ï¼ˆå†å²é—ç•™é—®é¢˜ï¼‰ç›¸å…³ <a href="https://github.com/docker/cli/issues/3793#issuecomment-1269051403" target="_blank" rel="noopener noreferrer">issues<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p>[x] <strong>æœ€ç»ˆè§£å†³æ–¹æ¡ˆï¼š</strong></p></li> <li><ul><li>ï¼ˆ1ï¼‰é¦–å…ˆé€šè¿‡docker login &lt;ç§æœ‰é•œåƒåœ°å€&gt;  ç™»å…¥ç§æœ‰é•œåƒä»“åº“ï¼Œç™»å…¥æˆåŠŸä¹‹åï¼Œä¼šåœ¨å¯¹åº”çš„ç”¨æˆ·å®¶ç›®å½•ä¸‹ç”Ÿæˆ <code>.docker/config.json</code> é…ç½®æ–‡ä»¶</li></ul></li> <li><ul><li>ï¼ˆ2ï¼‰é€šè¿‡<code>vi</code>å‘½ä»¤æ‰“å¼€é…ç½®æ–‡ä»¶ï¼Œç„¶åæ‰‹åŠ¨åœ¨<code>auths</code>é…ç½®å—é‡Œé¢æ·»åŠ å®˜æ–¹åœ°å€<code>https://index.docker.io/v1/</code>ï¼Œ<code>auth</code>å“ˆå¸Œå€¼ä¸ä½ çš„ç§æœ‰é•œåƒåœ°å€çš„authä¿æŒä¸€è‡´ï¼Œç„¶åé‡å¯dockerå³å¯ç›´æ¥é€šè¿‡<code>docker pull</code>æ‹‰å–äº†</li></ul></li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">vi</span> <span class="token environment constant">$HOME</span>/.docker/config.json
<span class="token punctuation">{</span>
      <span class="token string">&quot;auths&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
              <span class="token string">&quot;https://index.docker.io/v1/&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                      <span class="token string">&quot;auth&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;å¤åˆ¶ä¸‹é¢ç§æœ‰é•œåƒç™»å…¥è®¤è¯çš„å“ˆå¸Œå€¼å¡«åˆ°è¿™é‡Œ&quot;</span>
              <span class="token punctuation">}</span>,
              <span class="token string">&quot;ä½ çš„ç§æœ‰é•œåƒåœ°å€&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                      <span class="token string">&quot;auth&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;è‡ªåŠ¨ç”Ÿæˆçš„è®¤è¯å“ˆå¸Œå€¼&quot;</span>
              <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment"># é‡å¯ docker</span>
systemctl restart <span class="token function">docker</span>

<span class="token comment"># æ‹‰å–é•œåƒ</span>
<span class="token function">docker</span> pull nginx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h4 id="_11ã€å¦‚ä½•é…ç½®æ‰èƒ½è®©æ•°æ®ä¸ä¿ç•™åˆ°ç£ç›˜ä¸­"><a href="#_11ã€å¦‚ä½•é…ç½®æ‰èƒ½è®©æ•°æ®ä¸ä¿ç•™åˆ°ç£ç›˜ä¸­" class="header-anchor">#</a> 11ã€å¦‚ä½•é…ç½®æ‰èƒ½è®©æ•°æ®ä¸ä¿ç•™åˆ°ç£ç›˜ä¸­ï¼Ÿ</h4> <ul><li>[x] <strong>å·²çŸ¥é—®é¢˜ï¼š</strong> é»˜è®¤ä½¿ç”¨çš„å­˜å‚¨ç³»ç»Ÿä¸º<code>filesystem</code> ä½¿ç”¨æœ¬åœ°ç£ç›˜å­˜å‚¨æ³¨å†Œè¡¨æ–‡ä»¶</li> <li>[x] <strong>è§£å†³æ–¹æ¡ˆï¼š</strong> ä¿®æ”¹å¯¹åº”Registryçš„é…ç½®ï¼Œå°†<code>Storage driver</code> å­˜å‚¨é©±åŠ¨æ”¹ä¸º <code>inmemory</code>ï¼Œâš ï¸ æ³¨æ„ï¼šæ­¤å­˜å‚¨é©±åŠ¨ç¨‹åºä¸ä¼šåœ¨è¿è¡ŒæœŸé—´ä¿ç•™æ•°æ®ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ƒåªé€‚åˆæµ‹è¯•ã€‚åˆ‡å‹¿åœ¨ç”Ÿäº§ä¸­ä½¿ç”¨æ­¤é©±åŠ¨ç¨‹åºã€‚</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/docs/pages/install.html" class="prev">
        å®‰è£…éƒ¨ç½²
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/docs/assets/js/app.37458384.js" defer></script><script src="/docs/assets/js/2.6bef8de2.js" defer></script><script src="/docs/assets/js/1.0b991997.js" defer></script><script src="/docs/assets/js/24.0b5ffd20.js" defer></script>
  </body>
</html>
